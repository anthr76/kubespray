---
# Kubic ships with Python

- name: Check that /etc/sysconfig/proxy file exists
  stat:
    path: /etc/sysconfig/proxy
  register: stat_result

- name: Create the /etc/sysconfig/proxy empty file
  file:
    path: /etc/sysconfig/proxy
    state: touch
  when:
    - http_proxy is defined or https_proxy is defined
    - not stat_result.stat.exists

- name: Set the http_proxy in /etc/sysconfig/proxy
  lineinfile:
    path: /etc/sysconfig/proxy
    regexp: '^HTTP_PROXY='
    line: 'HTTP_PROXY="{{ http_proxy }}"'
  become: true
  when:
    - http_proxy is defined

- name: Set the https_proxy in /etc/sysconfig/proxy
  lineinfile:
    path: /etc/sysconfig/proxy
    regexp: '^HTTPS_PROXY='
    line: 'HTTPS_PROXY="{{ https_proxy }}"'
  become: true
  when:
    - https_proxy is defined

- name: Enable proxies
  lineinfile:
    path: /etc/sysconfig/proxy
    regexp: '^PROXY_ENABLED='
    line: 'PROXY_ENABLED="yes"'
  become: true
  when:
    - http_proxy is defined or https_proxy is defined

- name: Force binaries directory for MicroOS by OpenSUSE
  set_fact:
    bin_dir: "/opt/bin"
  tags:
    - facts

- name: Set the ansible_python_interpreter fact
  set_fact:
    ansible_python_interpreter: "/usr/bin/python3"
  tags:
    - facts
